<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.0.8 (451398)"/><meta name="keywords" content="面试技术"/><meta name="created" content="2015-11-10 10:39:34 +0000"/><meta name="source-url" content="http://blog.csdn.net/buutterfly/article/details/6617375"/><meta name="updated" content="2015-11-10 10:39:34 +0000"/><title>面试技术11. 内存溢出与内存泄露</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><b><font face="宋体">1. 定义:&nbsp;&nbsp;</font></b></div><b><font face="宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). 内存溢出: 即为out of memory, 当你要求分配的内存超过了系统给你的内存时,&nbsp;&nbsp; </font></b><div><b><font face="宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 系统就会抛出out of memory的异常(每个Android能用的内存是有限的) </font></b><div><b><font face="宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 比如: 当前应用只剩下4M的空间可用, 但你却加载得到一个需要占用5M空间的图片Bitmap对象, 就会抛出溢出的异常 </font></b></div><div><b><font face="宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). 内存泄露: 即为memory leak, 一个对象被创建后, 你不再使用它了, 但因为某种原因它又没有成为垃圾对象, 这块内存不能再被分配置使用 </font></b></div><div><b><font face="宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 比如: 查询数据库得到的cursor对象在使用完后没有关闭, Activity中使用Handler发延迟消息, 但退出前不移除未处理的消息 </font></b></div><div><b><font face="宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3). 内存泄露不多时没有太大影响, 但积累得多了就会导致应用运动缓慢, 到最后就会内存溢出 </font></b></div><div><hr/><font face="宋体"><b>2.&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;">内存泄漏的分类:</span></b></font></div><div><font face="宋体"><b><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;">1). 常发性内存泄漏: 发生内存泄漏的代码会被多次执行到，每次被执行的时候都会导致一块内存泄漏</span></b></font></div><div><font face="宋体"><b><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;">2). 偶发性内存泄漏: 发生内存泄漏的代码只有在某些特定环境或操作过程下才会发生。常发性和偶发性是相对的。</span></b></font></div><div><font face="宋体"><b><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 对于特定的环境，偶发性的也许就变成了常发性的 </span></b></font></div><div><font face="宋体"><b><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3).&nbsp;&nbsp; </span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;">一次性内存泄漏: 发生内存泄漏的代码只会被执行一次，或者由于算法上的缺陷，导致总会有一块仅且一块内存发生泄漏</span></b></font></div><div><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;"><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;说明: 危害性大小顺序为: &nbsp;&nbsp;1)>2)>3) </b></font></span></div><div><hr/><font face="宋体"><b>3. 造成内存泄露的几种场景</b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). 长生命周期的对象持有短生命周期对象的引用: &nbsp;&nbsp;Activity中使用Handler </b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). 资源数据连接相关对象不关闭: cusor, stream, connection </b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3). HashSet中的对象或HashMap中的Key对象, 基内部与hash值相关的属性被修改 </b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4). 一些对象产生后不会自动释放或需要完全执行完了才释放. 比如: Bitmap, Thread, AsyncTask </b></font></div><div><hr/></div><div><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 25px; text-align: left;"><font face="宋体"><b>4. 避免内存泄露</b></font></span></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><span style="background-color: rgb(255, 255, 255); line-height: 25.2000007629395px; text-align: left;"><font face="宋体"><b>1). 尽早释放无用对象的引用</b></font></span></div><p style="margin: 0px; padding: 0px; line-height: 25.2000007629395px; text-align: left; background-color: rgb(255, 255, 255);"><font face="宋体"><b>2). 使用字符串处理，避免使用String，应大量使用StringBuffer，每一个String对象都得独立占用内存一块区域</b></font></p><p style="margin: 0px; padding: 0px; line-height: 25.2000007629395px; text-align: left; background-color: rgb(255, 255, 255);"><font face="宋体"><b>3). 尽量少用静态变量，因为静态变量存放在永久代（方法区），永久代基本不参与垃圾回收</b></font></p><p style="margin: 0px; padding: 0px; line-height: 25.2000007629395px; text-align: left; background-color: rgb(255, 255, 255);"><font face="宋体"><b>4). 避免在循环中创建对象</b></font></p></blockquote><div><hr/></div><div><font face="宋体"><b>5. 造成内存溢出的的场景:</b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). 申请了太多的对象. 比如: 使用ListView时, 不复用convertView, 当数据项多时就会出现内存溢出 </b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). 创建的对象内存太大. 比如:&nbsp;&nbsp;不经过压缩直接加载大图片文件 </b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3). 内存泄露积累一定的时间后就可能出现 </b></font></div><div><hr/><font face="宋体"><b>6. 避免内存溢出:</b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1). 通过复用对象的方式, 减少产生的对象 </b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2). 大对象需要先压缩后创建 </b></font></div><div><font face="宋体"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3). 避免或减少内存泄露的情况 </b></font><br/><br/></div><div><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><hr/></div></div></body></html>