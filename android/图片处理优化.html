<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.0.8 (451398)"/><meta name="keywords" content="面试技术"/><meta name="created" content="2015-11-10 10:39:34 +0000"/><meta name="source-url" content="http://mobile.51cto.com/abased-406980.htm"/><meta name="updated" content="2015-11-10 12:30:35 +0000"/><title>面试技术12 图片处理优化</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><b style="font-size: 19px;">1. 大图片的加载显示(避免OOM问题):</b><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). 问题: 如果将大图片加载到内存中来显示, 可能会导致 <b><font color="#E30000">内存溢出(OOM)</font></b></div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). 解决思路: 对图片进行 <font color="#E30000"><b>压缩加载</b></font>(本质上只是读取了图片文件的部分数据)</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3). 具体办法: </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ①. 得到图片的宽高的方式:&nbsp;&nbsp; </div><table border="1" cellpadding="2" cellspacing="0" style="font-size: 19px;" width="100%"><tbody><tr><td valign="top"><ol style="margin: 0px 0px 1px 55px; padding: 5px 0px; list-style-position: initial; list-style-image: initial; word-wrap: break-word; word-break: normal; border: none; background-color: rgb(247, 247, 247);"><li style="font-family: &amp;apos;Courier New&amp;apos;, monospace; white-space: pre; margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">BitmapFactory.Options&nbsp;&nbsp;options&nbsp;&nbsp;=&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;BitmapFactory.Options();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; background-position: -498px -70px;"><span style="font-family: &amp;apos;Courier New&amp;apos;, monospace; line-height: 18px; white-space: pre; margin: 0px; padding: 0px; border: none; background-color: inherit;"><font color="#E30000">options.inJustDecodeBounds&nbsp;&nbsp;=&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; background-color: inherit; font-weight: bold;">true</span></font><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;"><font color="#E30000">;</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: 微软雅黑; line-height: normal; white-space: normal;"><font color="#E30000"><b>//设置只读取图片文件的边框,这样就不会加载整个图片文件</b></font></span></span></span></li><li style="font-family: &amp;apos;Courier New&amp;apos;, monospace; white-space: pre; margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">BitmapFactory.decodeResource(getResources(),&nbsp;&nbsp;R.id.myimage,&nbsp;&nbsp;options);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="font-family: &amp;apos;Courier New&amp;apos;, monospace; white-space: pre; margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;imageHeight&nbsp;&nbsp;=&nbsp;&nbsp;options.outHeight;&nbsp;&nbsp;<font color="#E30000">&nbsp;&nbsp;//图片的高&nbsp;&nbsp;</font></span></span></li><li style="font-family: &amp;apos;Courier New&amp;apos;, monospace; white-space: pre; margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;imageWidth&nbsp;&nbsp;=&nbsp;&nbsp;options.outWidth;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#E30000">//图片的宽</font></span></span></li><li style="font-family: &amp;apos;Courier New&amp;apos;, monospace; white-space: pre; color: rgb(92, 92, 92); margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">String&nbsp;&nbsp;imageType&nbsp;&nbsp;=&nbsp;&nbsp;options.outMimeType;&nbsp;&nbsp;</span></li></ol></td></tr></tbody></table><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 注意: 为了避免OOM异常，最好在解析每张图片的时候都先检查一下图片的大小， </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 除非你非常信任图片的来源，保证这些图片都不会超出你程序的可用内存&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ②. 计算取样比例的方式: </div><div style="font-size: 19px;"><table border="1" cellpadding="2" cellspacing="0" width="100%"><tbody><tr><td valign="top"><div><ol style="font-family: &amp;apos;Courier New&amp;apos;, monospace; line-height: 28px; white-space: pre; margin: 0px 0px 1px 55px; padding: 5px 0px; color: rgb(92, 92, 92); list-style-position: initial; list-style-image: initial; word-wrap: break-word; word-break: normal; border: none; background-color: rgb(247, 247, 247);"><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">static</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;calculateInSampleSize(BitmapFactory.Options&nbsp;&nbsp;options,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;reqWidth,&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;reqHeight)&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;源图片的高度和宽度&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">final</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;height&nbsp;&nbsp;=&nbsp;&nbsp;options.outHeight;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">final</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;width&nbsp;&nbsp;=&nbsp;&nbsp;options.outWidth;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;inSampleSize&nbsp;&nbsp;=&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(192, 0, 0); background-color: inherit;">1</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;(height&nbsp;&nbsp;>&nbsp;&nbsp;reqHeight&nbsp;&nbsp;||&nbsp;&nbsp;width&nbsp;&nbsp;>&nbsp;&nbsp;reqWidth)&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;计算出实际宽高和目标宽高的比率&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">final</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;heightRatio&nbsp;&nbsp;=&nbsp;&nbsp;Math.round((</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">)&nbsp;&nbsp;height&nbsp;&nbsp;/&nbsp;&nbsp;(</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">)&nbsp;&nbsp;reqHeight);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">final</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;widthRatio&nbsp;&nbsp;=&nbsp;&nbsp;Math.round((</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">)&nbsp;&nbsp;width&nbsp;&nbsp;/&nbsp;&nbsp;(</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">)&nbsp;&nbsp;reqWidth);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;选择宽和高中最小的比率作为inSampleSize的值，这样可以保证最终图片的宽和高&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;一定都会大于等于目标的宽和高。&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inSampleSize&nbsp;&nbsp;=&nbsp;&nbsp;heightRatio&nbsp;&nbsp;<&nbsp;&nbsp;widthRatio&nbsp;&nbsp;?&nbsp;&nbsp;heightRatio&nbsp;&nbsp;:&nbsp;&nbsp;widthRatio;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;inSampleSize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">}&nbsp;&nbsp;</span></li></ol></div></td></tr></tbody></table><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 注意: 如果inSampleSize=3, 表示 宽和高上只读取原来数据的1/3, 这样整体大小压缩为原来的1/9 </div></div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ③. 整体处理: </div><table border="1" cellpadding="2" cellspacing="0" style="font-size: 19px;" width="100%"><tbody><tr><td valign="top"><div><ol style="font-family: &amp;apos;Courier New&amp;apos;, monospace; line-height: 28px; white-space: pre; margin: 0px 0px 1px 55px; padding: 5px 0px; list-style-position: initial; list-style-image: initial; word-wrap: break-word; word-break: normal; border: none; background-color: rgb(247, 247, 247);"><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">static</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;Bitmap&nbsp;&nbsp;decodeSampledBitmapFromResource(Resources&nbsp;&nbsp;res,&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;resId,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="color: rgb(92, 92, 92); margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;reqWidth,&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;reqHeight)&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;第一次解析将inJustDecodeBounds设置为true，只获取图片宽,高大小&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="color: rgb(92, 92, 92); margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">final</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;BitmapFactory.Options&nbsp;&nbsp;options&nbsp;&nbsp;=&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;BitmapFactory.Options();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.inJustDecodeBounds&nbsp;&nbsp;=&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">true; //不会加载整个图片文件</span></span></li><li style="color: rgb(92, 92, 92); margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitmapFactory.decodeResource(res,&nbsp;&nbsp;resId,&nbsp;&nbsp;options);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;调用上面定义的方法计算inSampleSize值&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="color: rgb(92, 92, 92); margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.inSampleSize&nbsp;&nbsp;=&nbsp;&nbsp;calculateInSampleSize(options,&nbsp;&nbsp;reqWidth,&nbsp;&nbsp;reqHeight);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;使用获取到的inSampleSize值再次解析图片&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.inJustDecodeBounds&nbsp;&nbsp;=&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">;&nbsp;&nbsp;<font color="#147191"><b>//会根据inSampleSize加载图片的部分数据到内存&nbsp;&nbsp;</b>&nbsp;&nbsp;</font></span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;BitmapFactory.decodeResource(res,&nbsp;&nbsp;resId,&nbsp;&nbsp;options);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="color: rgb(92, 92, 92); margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">}&nbsp;&nbsp;</span></li></ol></div></td></tr></tbody></table><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;调用代码如下: </div><div style="font-size: 19px;"><table border="1" cellpadding="2" cellspacing="0" width="100%"><tbody><tr><td valign="top"><ol style="font-family: &amp;apos;Courier New&amp;apos;, monospace; line-height: 28px; white-space: pre; margin: 0px 0px 1px 55px; padding: 5px 0px; list-style-position: initial; list-style-image: initial; word-wrap: break-word; word-break: normal; border: none; background-color: rgb(247, 247, 247);"><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">mImageView.setImageBitmap(</span><span style="background-color: inherit;">decodeSampledBitmapFromResource(getResources(),&nbsp;&nbsp;R.id.myimage,&nbsp;&nbsp;</span><span style="background-color: inherit; margin: 0px; padding: 0px; border: none; color: rgb(192, 0, 0);">100</span><span style="background-color: inherit; margin: 0px; padding: 0px; border: none;">,&nbsp;&nbsp;</span><span style="background-color: inherit; margin: 0px; padding: 0px; border: none; color: rgb(192, 0, 0);">100</span><span style="background-color: inherit; margin: 0px; padding: 0px; border: none;">));&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-attachment: scroll; line-height: 18px; background-position: -498px -70px;"><font color="#E30000"><b>//将任意一张图片压缩成<span style="background-color: inherit; margin: 0px; padding: 0px; border: none;">100</span><span style="background-color: inherit; margin: 0px; padding: 0px; border: none;">*</span><span style="background-color: inherit; margin: 0px; padding: 0px; border: none;">100</span><span style="background-color: inherit; margin: 0px; padding: 0px; border: none;">的缩略图，并在ImageView上展示</span></b></font></li></ol></td></tr></tbody></table><div><br/></div></div><div style="font-size: 19px;"><hr/></div><div style="font-size: 19px;"><b>2. 缓存图片对象</b></div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). 在内存中缓存图片对象(Bitmap),  <font color="#E30000"><b>不要直接用Map&lt;String, Bitmap&gt;</b></font>类型的容器, 因为这样会导致bitmap对象太多太大时而没有去释放, 最终<font color="#E30000"><b>导致OOM</b></font></div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). 在Android2.3之前, 一般都用 <b><font color="#E30000">Map<String,&nbsp;&nbsp;SoftReference<Bitmap>></font></b>结构容器来缓存Bitmap对象, 这样在内存不太充足时, 垃圾回收器会将软引用对象释放.</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 但从2.3开始, 垃圾回收器可能在正常情况下就回收软引用对象, 这样会降低缓存的效果 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3). Android的v4兼容包中提供了 <font color="#E30000"><b>LruCache</b></font>来做缓存容器, 它的基本原理为:</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;把最近使用的对象用强引用存储在 LinkedHashMap 中，并且把最近 <font color="#E30000"><b>最少使用</b></font>的对象在缓存值达到预设定值之前从内存中移除</div><table border="1" cellpadding="2" cellspacing="0" style="font-size: 19px;" width="100%"><tbody><tr><td valign="top"><div><ol style="font-family: &amp;apos;Courier New&amp;apos;, monospace; line-height: 28px; white-space: pre; margin: 0px 0px 1px 55px; padding: 5px 0px; list-style-position: initial; list-style-image: initial; word-wrap: break-word; word-break: normal; border: none; background-color: rgb(247, 247, 247); color: rgb(92, 92, 92);"><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;"><br/></span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">private</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;LruCache<String,&nbsp;&nbsp;Bitmap>&nbsp;&nbsp;mMemoryCache; //缓存Bitmap的容器&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">protected</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;onCreate(Bundle&nbsp;&nbsp;savedInstanceState)&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;获取到可用内存的最大值，使用内存超出这个值会引起OutOfMemory异常。&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;LruCache通过构造函数传入缓存值，以KB为单位。&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;maxMemory&nbsp;&nbsp;=&nbsp;&nbsp;(</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">)&nbsp;&nbsp;(Runtime.getRuntime().maxMemory()&nbsp;&nbsp;/&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(192, 0, 0); background-color: inherit;">1024</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;使用最大可用内存值的1/8作为缓存的大小。&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;cacheSize&nbsp;&nbsp;=&nbsp;&nbsp;maxMemory&nbsp;&nbsp;/&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(192, 0, 0); background-color: inherit;">8</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mMemoryCache&nbsp;&nbsp;=&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;LruCache<String,&nbsp;&nbsp;Bitmap>(cacheSize)&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">protected</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;sizeOf(String&nbsp;&nbsp;key,&nbsp;&nbsp;Bitmap&nbsp;&nbsp;bitmap)&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;">//&nbsp;&nbsp;重写此方法来衡量每张图片的大小，默认返回图片数量。&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;bitmap.getByteCount()&nbsp;&nbsp;/&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(192, 0, 0); background-color: inherit;">1024</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;addBitmapToMemoryCache(String&nbsp;&nbsp;key,&nbsp;&nbsp;Bitmap&nbsp;&nbsp;bitmap)&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;(getBitmapFromMemCache(key)&nbsp;&nbsp;==&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">)&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mMemoryCache.put(key,&nbsp;&nbsp;bitmap);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;</span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;"><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;Bitmap&nbsp;&nbsp;getBitmapFromMemCache(String&nbsp;&nbsp;key)&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); background-color: inherit; font-weight: bold;">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;">&nbsp;&nbsp;mMemoryCache.get(key);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="margin: 0px; padding: 0px 3px 0px 10px; color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; background-image: url(http://images.51cto.com/images/art1105/images/0.gif); background-attachment: scroll; line-height: 18px; background-position: -498px -70px; background-repeat: no-repeat repeat;"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;">}</span></li></ol></div></td></tr></tbody></table><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><hr/><b>3. 主动释放bitmap对象</b></div><div style="font-size: 19px;"><table border="1" cellpadding="2" cellspacing="0" width="100%"><tbody><tr><td valign="top"><div><pre style="line-height: 18px; margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &amp;apos;Courier New&amp;apos;;"><span style="margin: 0px; padding: 0px; line-height: 1.5; color: rgb(0, 0, 255);">if</span>(!<span style="margin: 0px; padding: 0px; line-height: 1.5;">bmp.isRecycle() ){
   bmp.<b><font color="#E30000">recycle</font></b>()    </span><span style="margin: 0px; padding: 0px; line-height: 1.5; color: rgb(0, 128, 0);">// </span><span style="margin: 0px; padding: 0px; line-height: 1.5; color: rgb(0, 128, 0);">回收图片所占的内存</span>
   system.gc()      <span style="margin: 0px; padding: 0px; line-height: 1.5; color: rgb(0, 128, 0);">// </span><span style="margin: 0px; padding: 0px; line-height: 1.5; color: rgb(0, 128, 0);">提醒系统及时回收</span>
}
</pre></div></td></tr></tbody></table><div><br/></div></div><div style="font-size: 19px;"><hr/></div><div style="font-size: 19px;"><b>4. 设置加载图片的色彩模式:</b></div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Android中有四种，分别是： </div><blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px; font-size: 19px;"><div>ALPHA_8：每个像素占用1byte内存</div><div>ARGB_4444:每个像素占用2byte内存</div><div>ARGB_8888:每个像素占用4byte内存(默认)</div><div>RGB_565:每个像素占用2byte内存</div></blockquote><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;默认的模式显示的图片质量是最高的, 但也是占用内存最大的, 而如果使用ARGB_4444模式, 占用的内存就会减少为1/2, 但显示效果差别不明显 </div><div style="font-size: 19px;"><table border="1" cellpadding="2" cellspacing="0" width="100%"><tbody><tr><td valign="top"><div><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 23px; background-color: rgb(255, 255, 255);">&nbsp;&nbsp;BitmapFactory.Options options = new BitmapFactory.Options（）;</span></div><div><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 23px; background-color: rgb(255, 255, 255);"><font color="#E30000"><b>&nbsp;&nbsp;options.inPreferredConfig = Bitmap.Config.ARGB_4444;</b></font>&nbsp;&nbsp;</span></div><div><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 23px; background-color: rgb(255, 255, 255);">&nbsp;&nbsp;Bitmap img = BitmapFactory.decodeFile（"/sdcard/1.png"， options）;</span></div></td></tr></tbody></table></div><div style="font-size: 19px;"><br/><hr/></div><div style="font-size: 19px;"><b>5. 相关优秀Blog</b></div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;&nbsp; <a href="http://blog.csdn.net/guolin_blog/article/details/9316683">Android高效加载大图、多图解决方案，有效避免程序OOM</a></div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;&nbsp; <a href="http://www.cnblogs.com/sunzn/archive/2013/03/14/2960293.html">Android 编程下图片的内存优化</a></div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;&nbsp; <a href="http://www.cnblogs.com/elliotta/p/3633752.html">Android图片内存优化的几点心得</a></div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4. 图片优化实例:&nbsp;&nbsp; <a href="http://blog.csdn.net/guolin_blog/article/details/9526203">Android照片墙应用实现，再多的图片也不怕崩溃</a></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div><br/></div></body></html>