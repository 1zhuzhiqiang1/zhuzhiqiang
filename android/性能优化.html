<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.0.8 (451398)"/><meta name="keywords" content="面试技术"/><meta name="created" content="2015-11-10 10:39:36 +0000"/><meta name="source-url" content="http://www.trinea.cn/android/performance/"/><meta name="updated" content="2015-11-10 13:26:56 +0000"/><title>面试技术10: 性能优化</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="font-size: 19px;">1. 性能相关的两个概念</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). 响应时间 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指从用户操作开始到系统给用户以正确反馈的时间 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 系统处理时间 + 网络传输时间(可能没有) + 展现时间 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). TPS(Transactions Per Second) </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 每秒处理的事务数, 是系统吞吐量的一个指标 </div><div style="font-size: 19px;"><hr/></div><span style="font-size: 19px;">2. 什么是性能问题?</span><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;响应时间过长, 系统吞吐量过低, 高并发下内存泄漏 &nbsp;&nbsp;(ANR) </div><div style="font-size: 19px;"><hr/></div><div style="font-size: 19px;">3. 性能调优的方式: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). 降低执行时间 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 缓存(对象缓存,IO缓存, 网络缓存, DB缓存) </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数据存储类型优化 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;算法优化 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;逻辑优化 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JNI </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;需求优化 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). 同步改异步 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;利用多线程提高TPS </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3). 提前或延迟操作 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 错开时间段提高TPS </div><hr style="font-size: 19px;"/><div style="font-size: 19px;">4. 调优点:</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). Java代码部分优化 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). 布局优化、 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3). 数据库优化&nbsp;&nbsp; </div><div style="font-size: 19px;"><hr/>
5. Java代码优化之: 缓存优化:</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). 线程池 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). 图片缓存 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3). Message缓存 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4). ListView缓存 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5). layout缓存 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6).&nbsp;&nbsp;文件IO缓存 </div><div style="font-size: 19px;"><hr/></div><div style="font-size: 19px;">6. Java代码优化之: 数据存储优化</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1).&nbsp;&nbsp;数据类型选择: </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder/StringBuffer代替String </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SoftRefrence代替强引用 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LocalBroadcastManager代替普通BroadcastReceiver，效率和安全性都更高 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2).&nbsp;&nbsp;数据结构选择 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ArrayList与LinkedList的选择 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List与Map的选择 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Android中推荐用SparseArray代替Map<Integer,Object>, SparseArray内部使用二分法查找数据, 效率更高 </div><div style="font-size: 19px;"><hr/></div><div style="font-size: 19px;">7. Java代码优化之: 算法优化</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询考虑hash和二分，尽量不用递归 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;必要时可以考虑: 使用空间换时间 </div><div style="font-size: 19px;"><hr/>
8.&nbsp;&nbsp;逻辑优化</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要是理清程序逻辑，减少不必要的操作。 </div><div style="font-size: 19px;"><hr/>
9.&nbsp;&nbsp;异步，利用多线程提高TPS</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;充分利用多核Cpu优势，利用线程解决密集型计算、IO、网络等操作, 分线程处理完成后可以通过Handler与主线程交互 </div><div style="font-size: 19px;"><hr/>
10.&nbsp;&nbsp;提前或延迟操作，错开时间段提高TPS</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1) 延迟操作:&nbsp;&nbsp;不在Activity、Service、BroadcastReceiver的生命周期等对响应时间敏感函数中执行耗时操作，可适当delay </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2).&nbsp;&nbsp;提前操作:&nbsp;&nbsp;对于第一次调用较耗时操作，可统一放到初始化中，将耗时提前 </div><div style="font-size: 19px;"><hr/>
11.&nbsp;&nbsp;网络优化</div><blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px; font-size: 19px;"><div>a. 图片必须缓存，最好根据机型做图片做图片适配</div>
b. 所有http请求必须添加httptimeout<br/>
c. 开启gzip压缩<br/>
d. api接口数据以json格式返回，而不是xml或html<br/>
e. 根据http头信息中的Cache-Control及expires域确定是否缓存请求结果。<br/>
f. 确定网络请求的connection是否keep-alive<br/>
g. 减少网络请求次数，服务器端适当做请求合并。<br/>
h. 减少重定向次数
<div>i. api接口服务器端响应时间不超过100ms</div></blockquote><div style="font-size: 19px;"><hr/>
12. 布局优化:</div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1). 对于布局的选择: FrameLayout>RelativeLayout>LinearLayout </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2). <include>标签 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3). <viewstub>标签 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4). <merge>标签 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5).&nbsp;&nbsp;去除不必要的嵌套和View节点 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6).&nbsp;&nbsp;减少不必要的infalte, infalte布局后缓存起来 </div><div style="font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7). 多使用布局调优工具来查看布局情况并做出合理的优化 </div><div style="font-size: 19px;"><hr/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div style="font-size: 19px;"><br/></div><div><br/></div></body></html>